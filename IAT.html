<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>IAT</title>
  <script src="https://unpkg.com/jspsych@7.3.4"></script>
  <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet">
  <script src="https://unpkg.com/@jspsych/plugin-iat-html@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-instructions@2.1.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.2.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@1.0.3"></script>
</head>
<body></body>
<script>
var jsPsych = initJsPsych({
  on_finish: function() { jsPsych.data.displayData(); }
});

// Stimuli
var ned_strttl_stimuli = [
  { stimulus: 'Auto', category: 'STANDAARD NEDERLANDS' },
  { stimulus: 'Geld', category: 'STANDAARD NEDERLANDS' },
  { stimulus: 'Schoen', category: 'STANDAARD NEDERLANDS' },
  { stimulus: 'Weg', category: 'STANDAARD NEDERLANDS' },

  { stimulus: 'Waggie', category: 'STRAATTAAL' },
  { stimulus: 'Doekoe', category: 'STRAATTAAL' },
  { stimulus: 'Patta', category: 'STRAATTAAL' },
  { stimulus: 'Loesoe', category: 'STRAATTAAL' }
];

var ned_mig_stimuli = [
  { stimulus: 'Mohammed', category: 'MIGRANT' },
  { stimulus: 'Fatima', category: 'MIGRANT' },
  { stimulus: 'Ali', category: 'MIGRANT' },
  { stimulus: 'Zeynep', category: 'MIGRANT' },

  { stimulus: 'Jan', category: 'NIET MIGRANT' },
  { stimulus: 'Petra', category: 'NIET MIGRANT' },
  { stimulus: 'David', category: 'NIET MIGRANT' },
  { stimulus: 'Lotte', category: 'NIET MIGRANT' }
];


// Information pages
var info_pages = {
  type: jsPsychInstructions,
  pages: [
    `<div style="text-align:left; max-width:800px; margin:auto; font-size:18px;">
      <img src="https://www.uu.nl/sites/default/files/styles/original_image/public/uu-logo-en-geenwitruimte.png" 
           alt="UU logo" 
           style="width:200px; margin-right:20px; margin-top:20px;">
      
      <p>U staat op het punt om mee te doen aan een experiment dat onderdeel is van het onderzoeksproject
      <i>“Taalattitudes van LLMs”</i>.</p>

      <h3>Wat is het doel van dit onderzoek?</h3>
      <p>In dit project onderzoeken we of de associaties die taalmodellen met verschillende taalvariëteiten
      hebben, overeenkomen met de associaties van mensen. Dit experiment heeft als doel te onderzoeken welke
      associaties mensen hebben met Straattaal en Straattaalsprekers.</p>

      <h3>Hoe verloopt het experiment?</h3>
      <p>Het experiment bestaat uit twee delen. Na het accepteren van de voorwaarden begint het eerste deel.
      In dit deel zult u in verschillende rondes woorden en namen in twee groepen moeten classificeren
      (max. 4 minuten). In het tweede deel krijgt u enkele vragen over uzelf en over wat u van Straattaal
      vindt (max. 2 minuten).<br>
      Deelname aan dit onderzoek is volledig vrijwillig en u kunt op elk moment besluiten om niet deel te nemen
      of uw deelname te beëindigen, zonder opgaaf van reden en zonder nadelige gevolgen.</p>
    </div>`,

    `<div style="text-align:left; max-width:800px; margin:auto; font-size:18px;">
      <img src="https://www.uu.nl/sites/default/files/styles/original_image/public/uu-logo-en-geenwitruimte.png" 
           alt="UU logo" 
           style="width:200px; margin-right:20px; margin-top:20px;">      
      <h3>Hoe wordt mijn data verwerkt?</h3>
      <p>In dit experiment worden uw reactietijden en de correctheid van uw antwoorden opgeslagen, net als uw
      antwoorden op de vragenlijst van het tweede deel van het experiment. Identificatiegegevens worden direct
      verwijderd zodra ze zijn verwerkt. Het databestand zal dus geen directe identificatie gegevens bevatten.
      Het geanonimiseerde databestand wordt opgeslagen op Yoda, een beveiligd digitaal systeem van de Universiteit
      Utrecht. Nederlandse universiteiten zijn overeengekomen deze gegevens minimaal 10 jaar te bewaren. Ook zal
      de data openbaar gemaakt worden voor de wetenschappelijke gemeenschap, zodat andere onderzoekers de
      geldigheid van ons onderzoek kunnen controleren.</p>
      <p>In deze studie vragen we naast uw demografische gegevens ook naar uw etnische achtergrond. 
      Deze informatie helpt ons te begrijpen of uitkomsten, ervaringen of reacties verschillen tussen 
      verschillende groepen. We begrijpen dat dit een gevoelig onderwerp kan zijn. Alle gegevens worden 
      vertrouwelijk behandeld, veilig opgeslagen en alleen in geanonimiseerde vorm gebruikt, zodat niemand 
      individueel te herleiden is. </p>

      <h3>Vragen en klachten</h3>
      <p>Heeft u na het lezen van deze informatiebrief nog vragen over uw deelname? Neem dan gerust contact op
      met Hedwig Oldenhof via <a href="mailto:h.oldenhof@uu.nl">h.oldenhof@uu.nl</a>.<br>
      Als u een klacht heeft over dit onderzoek, kunt u een e-mail sturen naar
      <a href="mailto:etc-beta-geo@uu.nl">etc-beta-geo@uu.nl</a>. U komt dan in contact met een onafhankelijke
      contactpersoon die niet betrokken is bij dit onderzoek en uw klacht zorgvuldig zal behandelen.<br>
      Heeft u vragen of zorgen over uw privacy binnen dit project? Neem dan contact op via
      <a href="mailto:privacy-beta@uu.nl">privacy-beta@uu.nl</a>.</p>
    </div>`,
  ],
  show_clickable_nav: true,
  button_label_next: "Volgende",
  button_label_previous: "Vorige"
};

// Consent choice screen
var consent = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div style="text-align:left; max-width:800px; margin:auto; font-size:18px;">
      <img src="https://www.uu.nl/sites/default/files/styles/original_image/public/uu-logo-en-geenwitruimte.png" 
           alt="UU logo" 
           style="width:200px; margin-right:20px; margin-top:20px;">      
      <p>Door op de knop “Ik ga akkoord” te klikken, bevestig ik mijn vrijwillige deelname aan het project
      <i>“Taalattitudes van LLMs”</i> en verklaar ik het volgende:</p>
      <ul>
        <li> Ik heb de informatiebrief over het onderzoek zorgvuldig gelezen.</li>
        <li> Ik weet dat ik de onderzoeker kan bereiken met vragen over de studie via <a href="mailto:h.oldenhof@uu.nl">h.oldenhof@uu.nl</a>.</li>
        <li> Ik weet dat ik klachten over de studie kan indienen bij de ethische commissie van de Universiteit Utrecht (<a href="mailto:etc-beta-geo@uu.nl">etc-beta-geo@uu.nl</a>).</li>
        <li> Ik begrijp dat mijn deelname volledig vrijwillig is en dat ik op elk moment mag besluiten om niet deel te nemen of mijn deelname te beëindigen, zonder opgaaf van reden en zonder nadelige gevolgen.</li>
        <li> Ik geef toestemming voor de verwerking van mijn gegevens, mits deze anoniem of gecodeerd worden verwerkt, zoals toegelicht in de informatiebrief.</li>
        <li> Ik ga ermee akkoord dat deze geanonimiseerde data openlijk beschikbaar zal zijn voor de wetenschappelijke gemeenschap en minimaal tien jaar bewaard zal blijven.</li>
      </ul>
    </div>`,
  choices: ['Terug', 'Ik ga akkoord', 'Ik ga niet akkoord']
};

//record prolific ID
var prolific_ID = {
  type: jsPsychSurveyText,
  questions: [
    {prompt: 'Wat is uw Prolific ID?', name: 'Prolific_ID'}
  ]
}

function assignStimulusKeys(stimuli, categoryPositions) {
  return stimuli.map(s => ({
    stimulus: s.stimulus,
    stim_key_association: categoryPositions[s.category]
  }));
}

// Fixation cross
function createFixationTrial(duration=250) {
  return {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<div style="display:flex; justify-content:center; font-size:60px; position:relative; top:-15px;">+</div>`,
    choices: "NO_KEYS",
    trial_duration: duration
  };
}

// Create general IAT block
function createIATBlock(stimuli, leftLabels, rightLabels, fixationDuration=500) {
  return {
    timeline: [
      createFixationTrial(fixationDuration),
      {
        type: jsPsychIatHtml,
        stimulus: function() {
          return `<div style="font-size:60px; text-align:center;">${jsPsych.timelineVariable('stimulus')}</div>`;
        },
        stim_key_association: jsPsych.timelineVariable('stim_key_association'),
        html_when_wrong: '<span style="color:red;font-size:80px">X</span>',
        bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
        force_correct_key_press: true,
        display_feedback: true,
        trial_duration: 3000,
        left_category_key: 'f',
        right_category_key: 'j',
        left_category_label: leftLabels,
        right_category_label: rightLabels,
        response_ends_trial: true
      }
    ],
    timeline_variables: stimuli,
    randomize_order: true
  };
}

// RANDOMIZATION
// Randomize key configuration language varieties
let categoryPositionsBlock1;
if (Math.random() < 0.5) {
  categoryPositionsBlock1 = {'STANDAARD NEDERLANDS':'left', STRAATTAAL:'right'};
} else {
  categoryPositionsBlock1 = {'STANDAARD NEDERLANDS':'right', STRAATTAAL:'left'};
}

// Randomize what label combination is presented first
let categoryPositionsBlock2;
if (Math.random() < 0.5) {
  categoryPositionsBlock2 = {
    MIGRANT: categoryPositionsBlock1['STANDAARD NEDERLANDS'],
    ['NIET MIGRANT']: categoryPositionsBlock1.STRAATTAAL
  };
} else {
  categoryPositionsBlock2 = {
    MIGRANT: categoryPositionsBlock1.STRAATTAAL,
    ['NIET MIGRANT']: categoryPositionsBlock1['STANDAARD NEDERLANDS']
  };
}

//TRIAL BLOCKS
// Instructions block 1
var block1_instructions = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: function() {
    let leftCats = Object.keys(categoryPositionsBlock1).filter(k => categoryPositionsBlock1[k] == 'left');
    let rightCats = Object.keys(categoryPositionsBlock1).filter(k => categoryPositionsBlock1[k] == 'right');

    return `
      <div style="text-align:center; font-size:22px;">
        <p>In dit deel van het experiment ziet u steeds een woord in het midden van het scherm.</p>
        <p>Uw taak is om dit woord zo snel en zo correct mogelijk in te delen in de juiste categorie.</p>
        <br>
        <p><b>Druk op (f)</span> voor  ${leftCats.join(" + ")}</b></p>
        <p><b>Druk op (j)</span> voor  ${rightCats.join(" + ")}</b></p>
        <br>
        <p style="margin-top:40px;">Druk op de <b>spatiebalk</b> om te beginnen.</p>
      </div>
    `;
  },
  choices: [' ']
};

// 1: Straattaal vs. Standaard Nederlands
var block1 = {
  timeline: [
    block1_instructions,
    createIATBlock(
      assignStimulusKeys(ned_strttl_stimuli, categoryPositionsBlock1),
      Object.keys(categoryPositionsBlock1).filter(k => categoryPositionsBlock1[k] == 'left'),
      Object.keys(categoryPositionsBlock1).filter(k => categoryPositionsBlock1[k] == 'right')
    )
  ]
};

// Instructions block 2
var block2_instructions = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: function() {
    let leftCats = Object.keys(categoryPositionsBlock2).filter(k => categoryPositionsBlock2[k] == 'left');
    let rightCats = Object.keys(categoryPositionsBlock2).filter(k => categoryPositionsBlock2[k] == 'right');

    return `
      <div style="text-align:center; font-size:22px;">
        <p>In dit deel van het experiment ziet u steeds een naam in het midden van het scherm.</p>
        <p>Uw taak is om dit woord zo snel en zo correct mogelijk in te delen in de juiste categorie.</p>
        <br>
        <p><b>Druk op (f)</span> voor  ${leftCats.join(" + ")}</b></p>
        <p><b>Druk op (j)</span> voor  ${rightCats.join(" + ")}</b></p>
        <br>
        <p style="margin-top:40px;">Druk op de <b>spatiebalk</b> om te beginnen.</p>
      </div>
    `;
  },
  choices: [' ']
};

// 2: Names
var block2 = {
  timeline: [
    block2_instructions,
    createIATBlock(
      assignStimulusKeys(ned_mig_stimuli, categoryPositionsBlock2),
      Object.keys(categoryPositionsBlock2).filter(k => categoryPositionsBlock2[k] == 'left'),
      Object.keys(categoryPositionsBlock2).filter(k => categoryPositionsBlock2[k] == 'right')
    )
  ]
};

// Instructions block 3
var categoryPositionsBlock3 = {...categoryPositionsBlock1, ...categoryPositionsBlock2};
var block3_instructions = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: function() {
    let leftCats = Object.keys(categoryPositionsBlock3).filter(k => categoryPositionsBlock3[k] == 'left');
    let rightCats = Object.keys(categoryPositionsBlock3).filter(k => categoryPositionsBlock3[k] == 'right');

    return `
      <div style="text-align:center; font-size:22px;">
        <p>In dit deel van het experiment ziet u steeds of een naam of een woord in het midden van het scherm.</p>
        <p>Uw taak is om dit woord zo snel en zo correct mogelijk in te delen in de juiste categorie.</p>
        <br>
        <p><b>Druk op (f)</span> voor  ${leftCats.join(" + ")}</b></p>
        <p><b>Druk op (j)</span> voor  ${rightCats.join(" + ")}</b></p>
        <br>
        <p style="margin-top:40px;">Druk op de <b>spatiebalk</b> om te beginnen.</p>
      </div>
    `;
  },
  choices: [' ']
};

// 3: Words and Names
var block3 = {
  timeline: [
    block3_instructions,
    createIATBlock(
      assignStimulusKeys(ned_strttl_stimuli.concat(ned_mig_stimuli), categoryPositionsBlock3),
      Object.keys(categoryPositionsBlock3).filter(k => categoryPositionsBlock3[k] == 'left'),
      Object.keys(categoryPositionsBlock3).filter(k => categoryPositionsBlock3[k] == 'right')
    )
  ]
};

// Instructions block 4
var categoryPositionsBlock4 = {
  MIGRANT: categoryPositionsBlock2.MIGRANT === 'left' ? 'right' : 'left',
  ['NIET MIGRANT']: categoryPositionsBlock2['NIET MIGRANT'] === 'left' ? 'right' : 'left'
};
var block4_instructions = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: function() {
    let leftCats = Object.keys(categoryPositionsBlock4).filter(k => categoryPositionsBlock4[k] == 'left');
    let rightCats = Object.keys(categoryPositionsBlock4).filter(k => categoryPositionsBlock4[k] == 'right');

    return `
      <div style="text-align:center; font-size:22px;">
        <p>In dit deel van het experiment ziet u weer een naam in het midden van het scherm.</p>
        <p>Uw taak is om dit woord zo snel en zo correct mogelijk in te delen in de juiste categorie.</p>
        <br>
        <p><b>Druk op (f)</span> voor  ${leftCats.join(" + ")}</b></p>
        <p><b>Druk op (j)</span> voor  ${rightCats.join(" + ")}</b></p>
        <br>
        <p style="margin-top:40px;">Druk op de <b>spatiebalk</b> om te beginnen.</p>
      </div>
    `;
  },
  choices: [' ']
};

// 4: Names (keys reversed)
var block4 = {
  timeline: [
    block4_instructions,
    createIATBlock(
      assignStimulusKeys(ned_mig_stimuli, categoryPositionsBlock4),
      Object.keys(categoryPositionsBlock4).filter(k => categoryPositionsBlock4[k] == 'left'),
      Object.keys(categoryPositionsBlock4).filter(k => categoryPositionsBlock4[k] == 'right')
    )
  ]
};

// Instructions block 5
var categoryPositionsBlock5 = {...categoryPositionsBlock1, ...categoryPositionsBlock4};
var block5_instructions = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: function() {
    let leftCats = Object.keys(categoryPositionsBlock5).filter(k => categoryPositionsBlock5[k] == 'left');
    let rightCats = Object.keys(categoryPositionsBlock5).filter(k => categoryPositionsBlock5[k] == 'right');

    return `
      <div style="text-align:center; font-size:22px;">
        <p>In dit deel van het experiment ziet u steeds of een naam of een woord in het midden van het scherm.</p>
        <p>Uw taak is om dit woord zo snel en zo correct mogelijk in te delen in de juiste categorie.</p>
        <br>
        <p><b>Druk op (f)</span> voor  ${leftCats.join(" + ")}</b></p>
        <p><b>Druk op (j)</span> voor  ${rightCats.join(" + ")}</b></p>
        <br>
        <p style="margin-top:40px;">Druk op de <b>spatiebalk</b> om te beginnen.</p>
      </div>
    `;
  },
  choices: [' ']
};

// 5: Words and Names
var block5 = {
  timeline: [
    block5_instructions,
    createIATBlock(
      assignStimulusKeys(ned_strttl_stimuli.concat(ned_mig_stimuli), categoryPositionsBlock5),
      Object.keys(categoryPositionsBlock5).filter(k => categoryPositionsBlock5[k] == 'left'),
      Object.keys(categoryPositionsBlock5).filter(k => categoryPositionsBlock5[k] == 'right')
    )
  ]
};

// Likert scale labels
var likert_scale = [
  "Helemaal mee oneens",
  "Oneens",
  "Beetje oneens",
  "Neutraal",
  "Beetje mee eens",
  "Mee eens",
  "Helemaal mee eens"
];

var statements = {
  type: jsPsychSurveyLikert,
  questions: [
    {prompt: "Straattaal wordt vooral gesproken door mensen met een migratieachtergrond.", name: 'Vraag 1', labels: likert_scale},
    {prompt: "Jongens gebruiken vaker straattaal dan meisjes.", name: 'Vraag2', labels: likert_scale},
    {prompt: "Straattaal wordt vooral gesproken door mensen uit lagere sociale klassen.", name: 'Vraag3', labels: likert_scale},
    {prompt: "Mensen met geen migratieachtergrond gebruiken zelden Straattaal.", name: 'Vraag4', labels: likert_scale}
  ],
  randomize_question_order: true
};

//Demographics
var demographics = {
  type: jsPsychSurveyHtmlForm,
  preamble: `
    <h3>Demografische gegevens</h3>
    <p>Vul alstublieft de volgende informatie in:</p>
  `,
  html: `
    <label for="age">Leeftijd:</label><br>
    <input type="number" id="age" name="age" min="16" max="120" required><br><br>

    <label for="gender">Geslacht:</label><br>
    <select id="gender" name="gender" required>
      <option value="">-- Selecteer --</option>
      <option value="Man">Man</option>
      <option value="Vrouw">Vrouw</option>
      <option value="Anders">Anders</option>
      <option value="Wil niet zeggen">Wil niet zeggen</option>
    </select><br><br>

    <label for="education">Opleidingsniveau:</label><br>
    <select id="education" name="education" required>
      <option value="">-- Selecteer --</option>
      <option value="Basisonderwijs">Basisonderwijs</option>
      <option value="Middelbaar onderwijs">Middelbaar onderwijs</option>
      <option value="MBO">MBO</option>
      <option value="HBO">HBO</option>
      <option value="WO">WO</option>
      <option value="Anders">Anders</option>
    </select><br><br>

    <label for="born_nl">Bent u in Nederland geboren?</label><br>
    <select id="born_nl" name="born_nl" required onchange="document.getElementById('born_nl_text').style.display=this.value=='Nee'?'block':'none';">
      <option value="">-- Selecteer --</option>
      <option value="Ja">Ja</option>
      <option value="Nee">Nee</option>
    </select><br><br>

    <div id="born_nl_text" style="display:none;">
      <label for="born_nl_other">Waar bent u geboren?</label><br>
      <input type="text" id="born_nl_other" name="born_nl_other"><br><br>
    </div>

    <label for="parents_nl">Zijn uw ouders in Nederland geboren?</label><br>
    <select id="parents_nl" name="parents_nl" required onchange="document.getElementById('parents_nl_text').style.display=this.value=='Nee'?'block':'none';">
      <option value="">-- Selecteer --</option>
      <option value="Ja">Ja</option>
      <option value="Nee">Nee</option>
    </select><br><br>

    <div id="parents_nl_text" style="display:none;">
      <label for="parents_nl_other">Waar zijn uw ouders geboren?</label><br>
      <input type="text" id="parents_nl_other" name="parents_nl_other"><br><br>
    </div>

    <label for="languages">Gesproken moedertalen:</label><br>
    <textarea id="languages" name="languages" rows="3" cols="50" placeholder="Bijv. Nederlands, Engels"></textarea><br><br>
  `,
  button_label: "Volgende"
};

var end_screen = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div style="text-align:center; max-width:800px; margin:auto; font-size:20px;">
      <h2>Bedankt voor uw deelname!</h2>
      <p>Druk op sluiten om terug te gaan naar Prolific</p>
    </div>
  `,
  choices: ["Sluiten"]
};

// Timeline of the full experiment
var timeline = [info_pages, consent, prolific_ID, block1, block2, block3, block4, block5, statements, demographics, end_screen];
jsPsych.run(timeline);
</script>
</body>
</html>
